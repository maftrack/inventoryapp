"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8248],{5318:(e,s,c)=>{c.d(s,{A:()=>n});var i=c(8168),a=c(6540);let t={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"outlined"};var r=c(9121);let n=a.forwardRef(function(e,s){return a.createElement(r.A,(0,i.A)({},e,{ref:s,icon:t}))})},8248:(e,s,c)=>{c.r(s),c.d(s,{default:()=>u});var i=c(4848),a=c(5703),t=c.n(a),r=c(1531),n=c(8331),l=c(460),o=c(3608),d=c(6540),x=c(5093),v=c.n(x),f=c(5318),h=c(8383),m=c(3093);let u=e=>{let{purchase:s}=e,[c,a]=(0,d.useState)(null),[x,u]=(0,d.useState)({}),[j,p]=(0,d.useState)([]),[w,g]=(0,d.useState)(!1),[b,N]=(0,d.useState)(null),[y,k]=(0,d.useState)(null);(0,d.useEffect)(()=>{let e=async e=>{try{let s=await fetch("".concat("http://192.168.0.104:5216/api","/services/services-with-categories-customer?transactionId=").concat(e)),c=(await s.json()).map(e=>e.serviceId);p(c)}catch(e){console.error("Error fetching purchased services:",e)}};(async()=>{try{var c;let i=await fetch("".concat("http://192.168.0.104:5216/api","/services/services-with-categories")),t=await i.json();console.log(t);let r=t.reduce((e,s)=>{let c=s.categoryName;return e[c]||(e[c]=[]),e[c].push({id:s.serviceId,serviceName:s.serviceName,creditUsed:s.creditUsed||"N/A",expirationService:s.expirationService,status:s.status||"N/A",haveUnit:s.haveUnit}),e},{});a({customer:(null===(c=t[0])||void 0===c?void 0:c.customerName)||"N/A",services:r});let n=Object.keys(r).reduce((e,s)=>(e[s]=!0,e),{});u(n),await e(s.transactionId)}catch(e){console.error("Error fetching transaction data:",e)}})()},[s]);let S=e=>{u(s=>({...s,[e]:!s[e]}))},A=(e,s)=>{s?p(s=>[...s,e]):(N(e),g(!0))},U=(e,s)=>{if(s){let s=c.services[e].filter(e=>e.haveUnit).map(e=>e.id);p(e=>[...new Set([...e,...s])])}else k(e),g(!0)};return c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.Ay,{type:"primary",onClick:async()=>{console.log(j);let e=j.map(e=>({ServiceId:e,User:s.customerid,TransactionId:s.transactionId}));console.log(e);try{let s=await fetch("".concat("http://192.168.0.104:5216/api","/PurchaseService/UpdatePurchasesService"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();throw console.error("Error details:",e),Error("Failed to update purchases")}let c=await s.json();console.log(c),m.oR.success("Purchases updated successfully")}catch(e){console.error("There was a problem with the fetch operation:",e),m.oR.error(e.message)}},style:{marginBottom:16},children:"Update Purchases"}),(0,i.jsx)(n.A,{children:Object.entries(c.services).map((e,s)=>{let[c,a]=e;return(0,i.jsxs)("div",{className:"jsx-fe03a539c648c118",children:[(0,i.jsxs)("div",{style:{background:"#f0f0f0",padding:"12px 16px",borderRadius:"8px",boxShadow:"0 2px  8px rgba(0,0,0,0.1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},className:"jsx-fe03a539c648c118",children:[(0,i.jsxs)("span",{className:"jsx-fe03a539c648c118",children:[s+1,". ",c]}),(0,i.jsx)(l.A,{checked:a.some(e=>j.includes(e.id)),onChange:e=>U(c,e),style:{marginLeft:"auto"}}),(0,i.jsx)("div",{onClick:()=>S(c),style:{cursor:"pointer",marginLeft:"10px"},className:"jsx-fe03a539c648c118",children:x[c]?(0,i.jsx)(f.A,{}):(0,i.jsx)(h.A,{})})]}),x[c]&&(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 p-4 bg-white",children:(0,i.jsxs)("div",{className:"jsx-fe03a539c648c118 service-table",children:[(0,i.jsxs)("div",{className:"jsx-fe03a539c648c118 service-row header",children:[(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-name",children:"Service Name"}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-used",children:"Credit Used"}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-expired",children:"Expiration Date"}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-status",children:"Status"}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-actions",children:"Action"})]}),a.map(e=>(console.log("Service ID: ".concat(e.id,", Have Unit: ").concat(e.haveUnit)),(0,i.jsxs)("div",{className:"jsx-fe03a539c648c118 "+"service-row ".concat(j.includes(e.id)?"checked":""),children:[(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-name",children:e.serviceName}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-used",children:e.creditUsed}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-expired",children:e.expirationService?v()(e.expirationService).format("YYYY-MM-DD"):"N/A"}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-status",children:e.status}),(0,i.jsx)("div",{className:"jsx-fe03a539c648c118 service-actions",children:(0,i.jsx)(l.A,{checked:j.includes(e.id),onChange:s=>A(e.id,s),disabled:!e.haveUnit})})]},e.id)))]})})]},c)})}),(0,i.jsx)(o.A,{title:"Warning",visible:w,onOk:()=>{if(b)p(e=>e.filter(e=>e!==b));else if(y){let e=c.services[y].map(e=>e.id);p(s=>s.filter(s=>!e.includes(s)))}g(!1),N(null),k(null)},onCancel:()=>{if(g(!1),b)p(e=>[...e,b]);else if(y){let e=c.services[y].filter(e=>e.haveUnit).map(e=>e.id);p(s=>[...new Set([...s,...e])])}N(null),k(null)},okText:"Yes",cancelText:"No",children:(0,i.jsx)("p",{className:"jsx-fe03a539c648c118",children:b?"Warning, the credit used on this service will also be removed. Are you sure you want to remove this service?":"Warning, the credit used on all services in this category will also be removed. Are you sure you want to remove this category?"})}),(0,i.jsx)(t(),{id:"fe03a539c648c118",children:".service-table.jsx-fe03a539c648c118{margin:0 -16px}.service-row.jsx-fe03a539c648c118{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:12px 16px;border-bottom:1px solid#f0f0f0}.service-row.header.jsx-fe03a539c648c118{background:#fafafa;font-weight:500}.service-name.jsx-fe03a539c648c118{width:20%;min-width:200px}.service-expired.jsx-fe03a539c648c118{width:25%;color:#666}.service-status.jsx-fe03a539c648c118{width:20%}.service-used.jsx-fe03a539c648c118{width:15%}.service-actions.jsx-fe03a539c648c118{width:15%;min-width:120px;text-align:right}.checked.jsx-fe03a539c648c118{background-color:#fff20442}@media(max-width:768px){.service-row.jsx-fe03a539c648c118{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start}.service-name.jsx-fe03a539c648c118,.service-expired.jsx-fe03a539c648c118,.service-status.jsx-fe03a539c648c118,.service-actions.jsx-fe03a539c648c118,.service-used.jsx-fe03a539c648c118{width:100%;min-width:0}.service-actions.jsx-fe03a539c648c118{text-align:left;margin-top:8px}}"})]}):(0,i.jsx)("p",{children:"No valid data."})}}}]);