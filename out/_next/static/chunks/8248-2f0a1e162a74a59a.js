"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8248],{5318:(e,s,c)=>{c.d(s,{A:()=>n});var a=c(8168),i=c(6540);let t={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"outlined"};var r=c(9121);let n=i.forwardRef(function(e,s){return i.createElement(r.A,(0,a.A)({},e,{ref:s,icon:t}))})},8248:(e,s,c)=>{c.r(s),c.d(s,{default:()=>m});var a=c(4848),i=c(5703),t=c.n(i),r=c(1531),n=c(8331),o=c(460),l=c(3608),d=c(6540),x=c(5093),h=c.n(x),f=c(5318),v=c(8383),u=c(3093);let m=e=>{let{purchase:s}=e,[c,i]=(0,d.useState)(null),[x,m]=(0,d.useState)({}),[p,j]=(0,d.useState)([]),[w,b]=(0,d.useState)(!1),[g,y]=(0,d.useState)(null),[N,k]=(0,d.useState)(null);(0,d.useEffect)(()=>{let e=async e=>{try{let s=await fetch("".concat("https://inventoryapp-be-fuenbjdjhpahefh3.southeastasia-01.azurewebsites.net/api","/services/services-with-categories-customer?transactionId=").concat(e)),c=(await s.json()).map(e=>e.serviceId);j(c)}catch(e){console.error("Error fetching purchased services:",e)}};(async()=>{try{var c;let a=await fetch("".concat("https://inventoryapp-be-fuenbjdjhpahefh3.southeastasia-01.azurewebsites.net/api","/services/services-with-categories")),t=await a.json();console.log(t);let r=t.reduce((e,s)=>{let c=s.categoryName;return e[c]||(e[c]=[]),e[c].push({id:s.serviceId,serviceName:s.serviceName,creditUsed:s.creditUsed||"N/A",expirationService:s.expirationService,status:s.status||"N/A",haveUnit:s.haveUnit}),e},{});i({customer:(null===(c=t[0])||void 0===c?void 0:c.customerName)||"N/A",services:r});let n=Object.keys(r).reduce((e,s)=>(e[s]=!0,e),{});m(n),await e(s.transactionId)}catch(e){console.error("Error fetching transaction data:",e)}})()},[s]);let S=e=>{m(s=>({...s,[e]:!s[e]}))},A=(e,s)=>{s?j(s=>[...s,e]):(y(e),b(!0))},U=(e,s)=>{if(s){let s=c.services[e].filter(e=>e.haveUnit).map(e=>e.id);j(e=>[...new Set([...e,...s])])}else k(e),b(!0)};return c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Ay,{type:"primary",onClick:async()=>{console.log(p);let e=p.map(e=>({ServiceId:e,User:s.customerid,TransactionId:s.transactionId}));console.log(e);try{let s=await fetch("".concat("https://inventoryapp-be-fuenbjdjhpahefh3.southeastasia-01.azurewebsites.net/api","/PurchaseService/UpdatePurchasesService"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();throw console.error("Error details:",e),Error("Failed to update purchases")}let c=await s.json();console.log(c),u.oR.success("Purchases updated successfully")}catch(e){console.error("There was a problem with the fetch operation:",e),u.oR.error(e.message)}},style:{marginBottom:16},children:"Update Purchases"}),(0,a.jsx)(n.A,{children:Object.entries(c.services).map((e,s)=>{let[c,i]=e;return(0,a.jsxs)("div",{className:"jsx-fe03a539c648c118",children:[(0,a.jsxs)("div",{style:{background:"#f0f0f0",padding:"12px 16px",borderRadius:"8px",boxShadow:"0 2px  8px rgba(0,0,0,0.1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},className:"jsx-fe03a539c648c118",children:[(0,a.jsxs)("span",{className:"jsx-fe03a539c648c118",children:[s+1,". ",c]}),(0,a.jsx)(o.A,{checked:i.some(e=>p.includes(e.id)),onChange:e=>U(c,e),style:{marginLeft:"auto"}}),(0,a.jsx)("div",{onClick:()=>S(c),style:{cursor:"pointer",marginLeft:"10px"},className:"jsx-fe03a539c648c118",children:x[c]?(0,a.jsx)(f.A,{}):(0,a.jsx)(v.A,{})})]}),x[c]&&(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 p-4 bg-white",children:(0,a.jsxs)("div",{className:"jsx-fe03a539c648c118 service-table",children:[(0,a.jsxs)("div",{className:"jsx-fe03a539c648c118 service-row header",children:[(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-name",children:"Service Name"}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-used",children:"Credit Used"}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-expired",children:"Expiration Date"}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-status",children:"Status"}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-actions",children:"Action"})]}),i.map(e=>(console.log("Service ID: ".concat(e.id,", Have Unit: ").concat(e.haveUnit)),(0,a.jsxs)("div",{className:"jsx-fe03a539c648c118 "+"service-row ".concat(p.includes(e.id)?"checked":""),children:[(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-name",children:e.serviceName}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-used",children:e.creditUsed}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-expired",children:e.expirationService?h()(e.expirationService).format("YYYY-MM-DD"):"N/A"}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-status",children:e.status}),(0,a.jsx)("div",{className:"jsx-fe03a539c648c118 service-actions",children:(0,a.jsx)(o.A,{checked:p.includes(e.id),onChange:s=>A(e.id,s),disabled:!e.haveUnit})})]},e.id)))]})})]},c)})}),(0,a.jsx)(l.A,{title:"Warning",visible:w,onOk:()=>{if(g)j(e=>e.filter(e=>e!==g));else if(N){let e=c.services[N].map(e=>e.id);j(s=>s.filter(s=>!e.includes(s)))}b(!1),y(null),k(null)},onCancel:()=>{if(b(!1),g)j(e=>[...e,g]);else if(N){let e=c.services[N].filter(e=>e.haveUnit).map(e=>e.id);j(s=>[...new Set([...s,...e])])}y(null),k(null)},okText:"Yes",cancelText:"No",children:(0,a.jsx)("p",{className:"jsx-fe03a539c648c118",children:g?"Warning, the credit used on this service will also be removed. Are you sure you want to remove this service?":"Warning, the credit used on all services in this <category will also be removed. Are you sure you want to remove this category?"})}),(0,a.jsx)(t(),{id:"fe03a539c648c118",children:".service-table.jsx-fe03a539c648c118{margin:0 -16px}.service-row.jsx-fe03a539c648c118{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:12px 16px;border-bottom:1px solid#f0f0f0}.service-row.header.jsx-fe03a539c648c118{background:#fafafa;font-weight:500}.service-name.jsx-fe03a539c648c118{width:20%;min-width:200px}.service-expired.jsx-fe03a539c648c118{width:25%;color:#666}.service-status.jsx-fe03a539c648c118{width:20%}.service-used.jsx-fe03a539c648c118{width:15%}.service-actions.jsx-fe03a539c648c118{width:15%;min-width:120px;text-align:right}.checked.jsx-fe03a539c648c118{background-color:#fff20442}@media(max-width:768px){.service-row.jsx-fe03a539c648c118{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start}.service-name.jsx-fe03a539c648c118,.service-expired.jsx-fe03a539c648c118,.service-status.jsx-fe03a539c648c118,.service-actions.jsx-fe03a539c648c118,.service-used.jsx-fe03a539c648c118{width:100%;min-width:0}.service-actions.jsx-fe03a539c648c118{text-align:left;margin-top:8px}}"})]}):(0,a.jsx)("p",{children:"No valid data."})}}}]);