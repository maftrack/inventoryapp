(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7306],{2067:(e,c,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-purchase-form/purchased-manager",function(){return a(4729)}])},5204:(e,c,a)=>{"use strict";a.d(c,{A:()=>r});var t=a(4848);a(6540);var s=a(8331);let r=e=>{let{title:c,children:a,maxWidth:r=1200,fullWidth:i=!1}=e;return(0,t.jsx)(s.A,{title:c,bordered:!1,style:{width:"100%",maxWidth:i?"100%":r,margin:"0 auto",transition:"max-width 0.2s ease-in-out"},children:a})}},5318:(e,c,a)=>{"use strict";a.d(c,{A:()=>n});var t=a(8168),s=a(6540);let r={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"outlined"};var i=a(9121);let n=s.forwardRef(function(e,c){return s.createElement(i.A,(0,t.A)({},e,{ref:c,icon:r}))})},8530:(e,c,a)=>{"use strict";a.d(c,{A:()=>n});var t=a(8168),s=a(6540);let r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var i=a(9121);let n=s.forwardRef(function(e,c){return s.createElement(i.A,(0,t.A)({},e,{ref:c,icon:r}))})},5349:(e,c,a)=>{"use strict";a.d(c,{A:()=>n});var t=a(8168),s=a(6540);let r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};var i=a(9121);let n=s.forwardRef(function(e,c){return s.createElement(i.A,(0,t.A)({},e,{ref:c,icon:r}))})},7271:(e,c,a)=>{"use strict";a.d(c,{A:()=>n});var t=a(8168),s=a(6540);let r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var i=a(9121);let n=s.forwardRef(function(e,c){return s.createElement(i.A,(0,t.A)({},e,{ref:c,icon:r}))})},918:(e,c,a)=>{"use strict";a.d(c,{L3:()=>o,i4:()=>x,xV:()=>m});var t=a(4354),s=a(550),r=a(3302);let i=e=>{let{componentCls:c}=e;return{[c]:{position:"relative",maxWidth:"100%",minHeight:1}}},n=(e,c)=>{let{prefixCls:a,componentCls:t,gridColumns:s}=e,r={};for(let e=s;e>=0;e--)0===e?(r["".concat(t).concat(c,"-").concat(e)]={display:"none"},r["".concat(t,"-push-").concat(e)]={insetInlineStart:"auto"},r["".concat(t,"-pull-").concat(e)]={insetInlineEnd:"auto"},r["".concat(t).concat(c,"-push-").concat(e)]={insetInlineStart:"auto"},r["".concat(t).concat(c,"-pull-").concat(e)]={insetInlineEnd:"auto"},r["".concat(t).concat(c,"-offset-").concat(e)]={marginInlineStart:0},r["".concat(t).concat(c,"-order-").concat(e)]={order:0}):(r["".concat(t).concat(c,"-").concat(e)]=[{"--ant-display":"block",display:"block"},{display:"var(--ant-display)",flex:"0 0 ".concat(e/s*100,"%"),maxWidth:"".concat(e/s*100,"%")}],r["".concat(t).concat(c,"-push-").concat(e)]={insetInlineStart:"".concat(e/s*100,"%")},r["".concat(t).concat(c,"-pull-").concat(e)]={insetInlineEnd:"".concat(e/s*100,"%")},r["".concat(t).concat(c,"-offset-").concat(e)]={marginInlineStart:"".concat(e/s*100,"%")},r["".concat(t).concat(c,"-order-").concat(e)]={order:e});return r["".concat(t).concat(c,"-flex")]={flex:"var(--".concat(a).concat(c,"-flex)")},r},d=(e,c)=>n(e,c),l=(e,c,a)=>({["@media (min-width: ".concat((0,t.zA)(c),")")]:Object.assign({},d(e,a))}),o=(0,s.OF)("Grid",e=>{let{componentCls:c}=e;return{[c]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},()=>({})),x=e=>({xs:e.screenXSMin,sm:e.screenSMMin,md:e.screenMDMin,lg:e.screenLGMin,xl:e.screenXLMin,xxl:e.screenXXLMin}),m=(0,s.OF)("Grid",e=>{let c=(0,r.oX)(e,{gridColumns:24}),a=x(c);return delete a.xs,[i(c),d(c,""),d(c,"-xs"),Object.keys(a).map(e=>l(c,a[e],"-".concat(e))).reduce((e,c)=>Object.assign(Object.assign({},e),c),{})]},()=>({}))},4729:(e,c,a)=>{"use strict";a.r(c),a.d(c,{default:()=>b});var t=a(4848),s=a(5703),r=a.n(s),i=a(3608),n=a(8331),d=a(1531),l=a(6715),o=a(6540),x=a(5093),m=a.n(x),f=a(5204),u=a(1609),p=a(5318),h=a(8383),j=a(5349),v=a(3093);let b=()=>{let e=(0,l.useRouter)(),{data:c}=e.query,[a,s]=(0,o.useState)(null),[x,b]=(0,o.useState)({}),[g,N]=(0,o.useState)(null),[w,y]=(0,o.useState)(null),[S,k]=(0,o.useState)(null),[I,A]=(0,o.useState)(null),[C,E]=(0,o.useState)(null),[z,O]=(0,o.useState)(null),[M,P]=(0,o.useState)(!1),[U,L]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=localStorage.getItem("draftPurchaseData");e&&O(JSON.parse(e).creditUsed);let t=async e=>{try{var c;let a=await fetch("".concat("http://192.168.0.104:5216/api","/PurchaseService/get-purchased-services/").concat(e)),t=await a.json(),r=t.reduce((e,c)=>{let a=c.categoryName;return e[a]||(e[a]=[]),e[a].push(c),e},{});s({customer:null===(c=t[0])||void 0===c?void 0:c.customerName,services:r});let i=Object.keys(r).reduce((e,c)=>(e[c]=!0,e),{});b(i)}catch(e){console.error("Error fetching transaction data:",e)}},r=async e=>{console.log(a);try{let c=await fetch("".concat("http://192.168.0.104:5216/api","/purchaseservice/last-draft/").concat(e)),a=await c.json();N(a)}catch(e){console.error("Error fetching draft service:",e)}};if(c){let e=new URLSearchParams(atob(c)),a=e.get("transactionId"),s=e.get("totalPurchase"),i=e.get("csid"),n=e.get("csname");y(a),k(s),A(i),E(n),localStorage.setItem("transactionId",a),localStorage.setItem("totalPurchase",s),localStorage.setItem("csid",i),localStorage.setItem("csname",n),t(a),r(a)}else{let e=localStorage.getItem("transactionId"),c=localStorage.getItem("totalPurchase"),a=localStorage.getItem("csid"),s=localStorage.getItem("csname");e?(y(e),k(c),A(a),E(s),t(e),r(e)):console.error("No valid transaction data found.")}},[c]);let _=e=>{b(c=>({...c,[e]:!c[e]}))},R=c=>{let a=btoa(JSON.stringify(c));e.push("/manage-purchase-form/purchased-manager/update-purchase?data=".concat(a))};if(!a)return(0,t.jsx)("p",{children:"No valid data."});Object.values(a.services).flat().length;let T=Object.values(a.services).flat().reduce((e,c)=>e+(c.creditUsed||0),0),D=S-T,B=async()=>{if(!U)return;let e={transactionId:U.transactionId,serviceId:U.serviceId,creditUsed:U.creditUsed,status:"Confirmed",action:"apply draft"};P(!1);try{let c=await fetch("".concat("http://192.168.0.104:5216/api","/purchaseservice/update-purchase"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!c.ok){let e=await c.json();throw console.error("Error response:",e),Error("Network response was not ok")}v.oR.success("Application submitted successfully!"),localStorage.removeItem("draftPurchaseData"),O(0),window.location.reload()}catch(e){v.oR.error("Failed to submit application."),console.error("Error submitting application:",e)}};return(0,t.jsxs)(u.A,{children:[(0,t.jsxs)(f.A,{title:"Transaction ".concat(w," (").concat(S," Total Purchased)"),children:[(0,t.jsx)("br",{className:"jsx-7020dfc568d905c0"}),(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 row",children:[(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 col-md-3 mb-4 stretch-card transparent",children:(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 card card-tale",children:(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 card-body",children:[(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 mb-4",children:"Total Purchase"}),(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 fs-30 mb-2",children:S}),(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0",children:"Credit"})]})})}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 col-md-3 mb-4 stretch-card transparent",children:(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 card card-dark-blue",children:(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 card-body",children:[(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 mb-4",children:"Total Used"}),(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 fs-30 mb-2",children:T}),(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0",children:"Consumsed"})]})})}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 col-md-3 mb-4 stretch-card transparent",children:(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 card card-dark-blue",children:(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 card-body",children:[(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 mb-4",children:"Balance"}),(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 fs-30 mb-2",children:D}),(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0",children:"Available"})]})})}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 col-md-3 mb-4 stretch-card transparent",children:(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 card card-dark-blue",children:(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 card-body",children:[(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 mb-4",children:"Last Draft"}),(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0 fs-30 mb-2",children:null!==z?z:"No draft"})," ",null!==z&&(0,t.jsx)("p",{style:{textDecoration:"underline",cursor:"pointer"},onClick:()=>{let e=localStorage.getItem("draftPurchaseData");if(!e){v.oR.error("No draft data available to apply.");return}let c=JSON.parse(e),t=c.serviceId,s=null;for(let e in a.services)if(s=a.services[e].find(e=>e.serviceid===t))break;if(!s){v.oR.error("Service not found.");return}L({serviceName:s.serviceName,transactionId:c.transactionId,serviceId:c.serviceId,creditUsed:c.creditUsed}),P(!0)},className:"jsx-7020dfc568d905c0",children:"Apply Now"})]})})})]}),(0,t.jsxs)(i.A,{title:"Confirm Application",open:M,onOk:B,onCancel:()=>P(!1),okText:"Confirm",cancelText:"Cancel",children:[(0,t.jsx)("p",{className:"jsx-7020dfc568d905c0",children:"Are you sure you want to apply for the following service?"}),U&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"jsx-7020dfc568d905c0",children:[(0,t.jsx)("strong",{className:"jsx-7020dfc568d905c0",children:"Service Name:"})," ",U.serviceName]}),(0,t.jsxs)("p",{className:"jsx-7020dfc568d905c0",children:[(0,t.jsx)("strong",{className:"jsx-7020dfc568d905c0",children:"Credits Used:"})," ",U.creditUsed]})]})]}),(0,t.jsxs)(n.A,{title:"Customer: ".concat(C||"N/A"),style:{marginBottom:16},children:[Object.entries(a.services).map((e,c)=>{let[a,s]=e;return(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0",children:[(0,t.jsxs)("div",{onClick:()=>_(a),style:{background:"#f0f0f0",padding:"12px 16px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},className:"jsx-7020dfc568d905c0",children:[(0,t.jsxs)("span",{className:"jsx-7020dfc568d905c0",children:[" ",c+1,". ",a]}),x[a]?(0,t.jsx)(p.A,{}):(0,t.jsx)(h.A,{})]}),x[a]&&(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 p-4 bg-white",children:(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 service-table",children:[(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 service-row header",children:[(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-name",children:"Service Name"}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-used",children:"Credit Used"}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-expired",children:"Expiration Date"}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-status",children:"Status"}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-actions",children:"Action"})]}),s.map(e=>(0,t.jsxs)("div",{className:"jsx-7020dfc568d905c0 service-row",children:[(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-name",children:e.serviceName}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-used",children:e.creditUsed||"N/A"}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-expired",children:e.expirationService?m()(e.expirationService).format("YYYY-MM-DD"):"N/A"}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-status",children:e.status||"N/A"}),(0,t.jsx)("div",{className:"jsx-7020dfc568d905c0 service-actions ",children:(0,t.jsx)(d.Ay,{type:"link",icon:(0,t.jsx)(j.A,{}),onClick:()=>R(e)})})]},e.id))]})})]},a)}),(0,t.jsx)("br",{className:"jsx-7020dfc568d905c0"}),(0,t.jsx)(d.Ay,{type:"primary",onClick:()=>e.push("/manage-purchase-form"),style:{marginBottom:16},children:"Cancel"})]}),(0,t.jsx)(r(),{id:"7020dfc568d905c0",children:".service-collapse .ant-collapse-item{border-bottom:none!important;margin-bottom:16px;background:#fff;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;-webkit-box-shadow:0 2px 8px rgba(0,0,0,.1);-moz-box-shadow:0 2px 8px rgba(0,0,0,.1);box-shadow:0 2px 8px rgba(0,0,0,.1)}.service-collapse .ant-collapse-header{background:#fafafa;-webkit-border-radius:8px!important;-moz-border-radius:8px!important;border-radius:8px!important;font-weight:500}.service-table{margin:0 -16px}.service-row{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:12px 16px;border-bottom:1px solid#f0f0f0}.service-row.header{background:#fafafa;font-weight:500}.service-name{width:20%;min-width:200px}.service-expired{width:25%;color:#666}.service-status{width:20%}.service-used{width:15%}.service-actions{width:15%;min-width:120px;text-align:right}@media(max-width:768px){.service-row{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start}.service-name,.service-expired,.service-status,.service-actions,.service-used{width:100%;min-width:0}.service-actions{text-align:left;margin-top:8px}}"})]}),(0,t.jsx)(v.N9,{})]})}},6715:(e,c,a)=>{e.exports=a(8440)}},e=>{var c=c=>e(e.s=c);e.O(0,[3197,994,1531,8331,3418,2453,1106,3093,3608,5029,1609,636,6593,8792],()=>c(2067)),_N_E=e.O()}]);