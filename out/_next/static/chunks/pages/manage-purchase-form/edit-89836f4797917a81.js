(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3933],{1701:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-purchase-form/edit",function(){return a(8240)}])},5204:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(4848);a(6540);var s=a(8331);let n=e=>{let{title:t,children:a,maxWidth:n=1200,fullWidth:i=!1}=e;return(0,r.jsx)(s.A,{title:t,bordered:!1,style:{width:"100%",maxWidth:i?"100%":n,margin:"0 auto",transition:"max-width 0.2s ease-in-out"},children:a})}},1603:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(5872),s=a(1280);let n=r.A.generatePicker(s.A)},8240:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var r=a(4848),s=a(6540),n=a(5093),i=a.n(n),o=a(8728),c=a(2546),l=a(6740),d=a(1027),u=a(7353),h=a(6216),m=a(3962),p=a(1531),x=a(5204),f=a(1609),j=a(6715),A=a.n(j),y=a(3093),w=a(1603),g=a(8248);let{Option:D}=o.A,{TabPane:P}=c.A,b=()=>{let[e]=l.A.useForm(),[t,a]=(0,s.useState)(null),[n,j]=(0,s.useState)([]),b=(0,s.useRef)(null);(0,s.useEffect)(()=>{let t=new URLSearchParams(window.location.search).get("transactionId"),r=async()=>{try{let e=await fetch("".concat("http://192.168.0.104:5216/api","/customers"));if(!e.ok)throw Error("Failed to fetch customers");let t=await e.json();j(t)}catch(e){y.oR.error(e.message)}};(async()=>{try{let r=await fetch("".concat("http://192.168.0.104:5216/api","/Purchase/").concat(t));if(!r.ok)throw Error("Failed to fetch purchase data");let s=await r.json();a(s),b.current=i()(s.purchaseDate).toDate(),e.setFieldsValue({transactionId:s.transactionId,customerName:s.customerid,creditsPurchased:s.creditsPurchased,purchaseDate:i()(s.purchaseDate),expirationDate:i()(s.expirationDate),paymentMethod:s.paymentMethod,status:s.status,notes:s.notes})}catch(e){y.oR.error(e.message)}})(),r()},[e]);let C=t=>{if(t){let a=t.clone().add(3,"years");e.setFieldsValue({expirationDate:a})}},I=async e=>{try{let t=await fetch("".concat("http://192.168.0.104:5216/api","/ManageServices/total-credits-used/").concat(e));if(!t.ok)throw Error("Failed to fetch total credits used");return(await t.json()).totalCreditsUsed||0}catch(e){return y.oR.error(e.message),0}},v=async e=>{if(await I(e.transactionId)>e.creditsPurchased){y.oR.error("Cannot edit purchase: total credits used exceeds credits purchased.");return}let t=i()(),a=i()(b.current),r=i()(e.expirationDate),s=i()(e.purchaseDate);if(console.log("Current Date:",t.format()),console.log("Initial Purchase Date:",a.format()),console.log("Expiration Date:",r.format()),console.log("Purchase Date:",s.format()),s.startOf("day").isBefore(t.startOf("day"))){y.oR.error("Cannot edit purchase: purchase date must be today or in the future.");return}if(r.isBefore(t)||r.isBefore(a)){y.oR.error("Cannot edit purchase: expiration date must be greater than the current date and the purchase date.");return}let n={...e,purchaseDate:e.purchaseDate.toISOString(),expirationDate:e.expirationDate.toISOString(),Customerid:e.customerName};console.log("Values being sent:",n);try{let e=await fetch("".concat("http://192.168.0.104:5216/api","/Purchase/").concat(n.transactionId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){let t=await e.json();throw console.error("Error details:",t),Error("Failed to update purchase")}y.oR.success("Purchase updated successfully",{onClose:()=>{A().push("/manage-purchase-form/")},autoClose:3e3})}catch(e){console.error("Error updating purchase:",e),y.oR.error(e.message)}};return(0,r.jsxs)(f.A,{children:[(0,r.jsx)(x.A,{title:"Edit Purchase",children:(0,r.jsxs)(c.A,{defaultActiveKey:"1",children:[(0,r.jsx)(P,{tab:"Purchase Details",children:(0,r.jsxs)(l.A,{form:e,onFinish:v,layout:"vertical",children:[(0,r.jsx)(l.A.Item,{label:"Transaction ID",name:"transactionId",children:(0,r.jsx)(d.A,{disabled:!0})}),(0,r.jsx)(l.A.Item,{label:"Customer",name:"customerName",rules:[{required:!0,message:"Please select a user!"}],children:(0,r.jsx)(o.A,{placeholder:"Select a user",children:n.map(e=>(0,r.jsx)(D,{value:e.id,children:e.fullName},e.id))})}),(0,r.jsx)(l.A.Item,{label:"Credits Purchased",name:"creditsPurchased",rules:[{required:!0,message:"Please input credits purchased!"}],children:(0,r.jsx)(d.A,{type:"number",placeholder:"100"})}),(0,r.jsx)(u.A,{style:{marginBottom:"16px"},closable:!0,message:"Informational Notes",description:"Default, the purchase will expire after 3 years from the purchase date.",type:"info",showIcon:!0}),(0,r.jsxs)(h.A,{gutter:16,children:[(0,r.jsx)(m.A,{span:12,children:(0,r.jsx)(l.A.Item,{label:"Purchase Date",name:"purchaseDate",rules:[{required:!0}],children:(0,r.jsx)(w.A,{showTime:!0,format:"YYYY-MM-DD HH:mm",style:{width:"100%"},onChange:e=>{C(e)}})})}),(0,r.jsx)(m.A,{span:12,children:(0,r.jsx)(l.A.Item,{label:"Expiration Date",name:"expirationDate",rules:[{required:!0}],children:(0,r.jsx)(w.A,{showTime:!0,format:"YYYY-MM-DD HH:mm",style:{width:"100%"}})})})]}),(0,r.jsx)(l.A.Item,{label:"Payment Method",name:"paymentMethod",children:(0,r.jsxs)(o.A,{placeholder:"Select payment method",children:[(0,r.jsx)(D,{value:"Credit Card",children:"Credit Card"}),(0,r.jsx)(D,{value:"Bank Transfer",children:"Bank Transfer"}),(0,r.jsx)(D,{value:"PayPal",children:"PayPal"})]})}),(0,r.jsx)(l.A.Item,{label:"Status",name:"status",children:(0,r.jsxs)(o.A,{children:[(0,r.jsx)(D,{value:"Completed",children:"Completed"}),(0,r.jsx)(D,{value:"Pending",children:"Pending"}),(0,r.jsx)(D,{value:"Canceled",children:"Canceled"})]})}),(0,r.jsx)(l.A.Item,{label:"Notes (Optional)",name:"notes",children:(0,r.jsx)(d.A.TextArea,{placeholder:"Additional details about the purchase"})}),(0,r.jsx)(l.A.Item,{children:(0,r.jsx)(p.Ay,{type:"primary",htmlType:"submit",children:"Update Purchase"})})]})},"1"),(0,r.jsx)(P,{tab:"Service Details",children:(0,r.jsx)(g.default,{purchase:t})},"2")]})}),(0,r.jsx)(y.N9,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[3197,994,1531,8331,3418,2453,5262,7239,2084,1106,8728,3067,6740,3093,3608,5029,6174,460,355,1609,8248,636,6593,8792],()=>t(1701)),_N_E=e.O()}]);