(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7767],{4997:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-purchase-form/addPurchase",function(){return t(4600)}])},5204:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var a=t(4848);t(6540);var r=t(8331);let i=e=>{let{title:s,children:t,maxWidth:i=1200,fullWidth:c=!1}=e;return(0,a.jsx)(r.A,{title:s,bordered:!1,style:{width:"100%",maxWidth:c?"100%":i,margin:"0 auto",transition:"max-width 0.2s ease-in-out"},children:t})}},1603:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var a=t(5872),r=t(1280);let i=a.A.generatePicker(r.A)},8826:(e,s,t)=>{"use strict";t.d(s,{A:()=>d});var a=t(8168),r=t(6540);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"};var c=t(9121);let d=r.forwardRef(function(e,s){return r.createElement(c.A,(0,a.A)({},e,{ref:s,icon:i}))})},4600:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var a=t(4848),r=t(6540),i=t(5093),c=t.n(i),d=t(8728),n=t(2546),l=t(6740),o=t(1031),h=t(1027),u=t(7353),x=t(6216),m=t(3962),b=t(5204),p=t(1609),j=t(3093);t(4338);var v=t(1603),f=t(8232);let{Option:w}=d.A,{TabPane:g}=n.A,y=()=>{let[e]=l.A.useForm(),[s,t]=(0,r.useState)(null),[i,y]=(0,r.useState)("1"),[A,N]=(0,r.useState)(!1),[P,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("https://inventoryapp-be-fuenbjdjhpahefh3.southeastasia-01.azurewebsites.net/api","/customers/GetCustomersName"));if(e.ok){let s=await e.json();S(s)}else throw Error("Failed to fetch customers")}catch(e){console.error("Error fetching customers:",e),j.oR.error("Failed to load customers. Please try again.")}})()},[]);let D=async s=>{let t={TransactionId:s.transactionId,Customerid:s.user,CreditsPurchased:s.creditsPurchased,PurchaseDate:s.purchaseDate.format("YYYY-MM-DDTHH:mm:ss"),ExpirationDate:s.expirationDate.format("YYYY-MM-DDTHH:mm:ss"),PaymentMethod:s.paymentMethod||"N/A",Status:s.status||"Pending",Notes:s.notes||"N/A"};try{let s=await fetch("".concat("https://inventoryapp-be-fuenbjdjhpahefh3.southeastasia-01.azurewebsites.net/api","/Purchase"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok)await s.json(),j.oR.success("Purchase created successfully!"),e.resetFields();else if(409===s.status){let e=await s.json();j.oR.error(e.message)}else throw Error("Network response was not ok")}catch(e){console.error("Error creating purchase:",e),j.oR.error("Failed to create purchase. Please try again.")}},I=async a=>{if("2"===a){if(P){y("2");return}N(!0);try{let s=await e.validateFields();if(!s.transactionId){j.oR.error("Transaction ID is required before proceeding."),N(!1);return}await D(s),setTimeout(()=>{t(s),y("2"),k(!0),j.oR.success("Data stored successfully!"),N(!1)},2e3)}catch(e){j.oR.error("Please complete all required fields before proceeding."),N(!1)}}else"1"===a?(y("1"),s?k(!0):k(!1)):y(a)};return(0,a.jsx)(p.A,{style:{minHeight:"100vh"},children:(0,a.jsxs)(b.A,{title:"Manage Purchase Form",children:[(0,a.jsxs)(n.A,{activeKey:i,onChange:I,children:[(0,a.jsx)(g,{tab:"Purchase",children:(0,a.jsx)(o.A,{spinning:A,tip:"Please wait, storing...",children:(0,a.jsxs)(l.A,{form:e,initialValues:{purchaseDate:c()(),status:"Pending"},layout:"vertical",children:[(0,a.jsx)(l.A.Item,{label:"Transaction ID (Mandatory)",name:"transactionId",children:(0,a.jsx)(h.A,{placeholder:"TXNxxxxx",disabled:P})}),(0,a.jsx)(l.A.Item,{label:"Customer",name:"user",rules:[{required:!0,message:"Please select a user!"}],children:(0,a.jsx)(d.A,{placeholder:"Select a user",disabled:P,children:C.map(e=>(0,a.jsx)(w,{value:e.Id,children:e.fullName},e.id))})}),(0,a.jsx)(l.A.Item,{label:"Credits Purchased",name:"creditsPurchased",rules:[{required:!0,message:"Please input credits purchased!"}],children:(0,a.jsx)(h.A,{type:"number",placeholder:"100",disabled:P})}),(0,a.jsx)(u.A,{style:{marginBottom:"16px"},closable:!0,message:"Informational Notes",description:"Default, the purchase will expire after 3 years from the purchase date.",type:"info",showIcon:!0}),(0,a.jsxs)(x.A,{gutter:16,children:[(0,a.jsx)(m.A,{span:12,children:(0,a.jsx)(l.A.Item,{label:"Purchase Date",name:"purchaseDate",rules:[{required:!0}],children:(0,a.jsx)(v.A,{onChange:s=>{if(s){let t=s.clone().add(3,"years");e.setFieldsValue({expirationDate:t})}},showTime:!0,format:"YYYY-MM-DD HH:mm",style:{width:"100%"},disabled:P})})}),(0,a.jsx)(m.A,{span:12,children:(0,a.jsx)(l.A.Item,{label:"Expiration Date",name:"expirationDate",rules:[{required:!0}],children:(0,a.jsx)(v.A,{showTime:!0,format:"YYYY-MM-DD HH:mm",style:{width:"100%"},disabled:P})})})]}),(0,a.jsx)(l.A.Item,{label:"Payment Method (Optional)",name:"paymentMethod",children:(0,a.jsxs)(d.A,{placeholder:"Select payment method",disabled:P,children:[(0,a.jsx)(w,{value:"Credit Card",children:"Credit Card"}),(0,a.jsx)(w,{value:"Bank Transfer",children:"Bank Transfer"}),(0,a.jsx)(w,{value:"PayPal",children:"PayPal"})]})}),(0,a.jsx)(l.A.Item,{label:"Status",name:"status",children:(0,a.jsxs)(d.A,{disabled:P,children:[(0,a.jsx)(w,{value:"Completed",children:"Completed"}),(0,a.jsx)(w,{value:"Pending",children:"Pending"}),(0,a.jsx)(w,{value:"Canceled",children:"Canceled"})]})}),(0,a.jsx)(l.A.Item,{label:"Notes (Optional)",name:"notes",children:(0,a.jsx)(h.A.TextArea,{placeholder:"Additional details about the purchase",disabled:P})})]})})},"1"),(0,a.jsx)(g,{tab:"Services",children:(0,a.jsx)(f.default,{purchase:s})},"2")]}),(0,a.jsx)(j.N9,{})]})})}},8232:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(4848),r=t(5703),i=t.n(r),c=t(1531),d=t(8331),n=t(460),l=t(6715),o=t(6540),h=t(5093),u=t.n(h),x=t(5318),m=t(8383),b=t(3093);let p=e=>{let{purchase:s}=e;(0,l.useRouter)();let[t,r]=(0,o.useState)(null),[h,p]=(0,o.useState)({}),[j,v]=(0,o.useState)([]);(0,o.useEffect)(()=>{fetch("".concat("https://inventoryapp-be-fuenbjdjhpahefh3.southeastasia-01.azurewebsites.net/api","/services/services-with-categories")).then(e=>e.json()).then(e=>{var s;let t=e.reduce((e,s)=>{let t=s.categoryName;return e[t]||(e[t]=[]),e[t].push({id:s.serviceId,serviceName:s.serviceName,creditUsed:s.creditUsed||"N/A",expirationService:s.expirationService,status:s.status||"N/A"}),e},{});r({customer:(null===(s=e[0])||void 0===s?void 0:s.customerName)||"N/A",services:t}),p(Object.keys(t).reduce((e,s)=>(e[s]=!0,e),{}))}).catch(e=>{console.error("Error fetching transaction data:",e)})},[]);let f=e=>{p(s=>({...s,[e]:!s[e]}))},w=(e,s)=>{v(t=>s?[...t,e]:t.filter(s=>s!==e))},g=(e,s)=>{if(t.services[e]){let a=t.services[e].map(e=>e.id);v(e=>s?[...new Set([...e,...a])]:e.filter(e=>!a.includes(e)))}};return t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Ay,{type:"primary",onClick:async()=>{console.log(j),console.log(s);let e=j.map(e=>({serviceId:e,user:s.user,transactionId:s.transactionId}));try{let s=await fetch("".concat("https://inventoryapp-be-fuenbjdjhpahefh3.southeastasia-01.azurewebsites.net/api","/PurchaseService/CreatePurchasesService"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});s.ok||b.oR.error("Error creating purchase");let t=await s.json();console.log(t),b.oR.success("Purchase created successfully")}catch(e){console.error("There was a problem with the fetch operation:",e)}},style:{marginBottom:16},children:"Complete"}),(0,a.jsx)(d.A,{children:Object.entries(t.services).map((e,s)=>{let[t,r]=e;return(0,a.jsxs)("div",{className:"jsx-b70db42088342716",children:[(0,a.jsxs)("div",{style:{background:"#f0f0f0",padding:"12px 16px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},className:"jsx-b70db42088342716",children:[(0,a.jsxs)("span",{className:"jsx-b70db42088342716",children:[" ",s+1,". ",t]}),(0,a.jsx)(n.A,{checked:r.some(e=>j.includes(e.id)),onChange:e=>g(t,e),style:{marginLeft:"auto"}}),(0,a.jsx)("div",{onClick:()=>f(t),style:{cursor:"pointer",marginLeft:"10px"},className:"jsx-b70db42088342716",children:h[t]?(0,a.jsx)(x.A,{}):(0,a.jsx)(m.A,{})})]}),h[t]&&(0,a.jsx)("div",{className:"jsx-b70db42088342716 p-4 bg-white",children:(0,a.jsxs)("div",{className:"jsx-b70db42088342716 service-table",children:[(0,a.jsxs)("div",{className:"jsx-b70db42088342716 service-row header",children:[(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-name",children:"Service Name"}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-used",children:"Credit Used"}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-expired",children:"Expiration Date"}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-status",children:"Status"}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-actions",children:"Action"})]}),r.map(e=>(0,a.jsxs)("div",{className:"jsx-b70db42088342716 "+"service-row ".concat(j.includes(e.id)?"checked":""),children:[(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-name",children:e.serviceName}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-used",children:e.creditUsed}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-expired",children:e.expirationService?u()(e.expirationService).format("YYYY-MM-DD"):"N/A"}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-status",children:e.status}),(0,a.jsx)("div",{className:"jsx-b70db42088342716 service-actions",children:(0,a.jsx)(n.A,{checked:j.includes(e.id),onChange:s=>w(e.id,s)})})]},e.id))]})})]},t)})}),(0,a.jsx)(i(),{id:"b70db42088342716",children:".service-table.jsx-b70db42088342716{margin:0 -16px}.service-row.jsx-b70db42088342716{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:12px 16px;border-bottom:1px solid#f0f0f0}.service-row.header.jsx-b70db42088342716{background:#fafafa;font-weight:500}.service-name.jsx-b70db42088342716{width:20%;min-width:200px}.service-expired.jsx-b70db42088342716{width:25%;color:#666}.service-status.jsx-b70db42088342716{width:20%}.service-used.jsx-b70db42088342716{width:15%}.service-actions.jsx-b70db42088342716{width:15%;min-width:120px;text-align:right}.checked.jsx-b70db42088342716{background-color:#fff20442}@media(max-width:768px){.service-row.jsx-b70db42088342716{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start}.service-name.jsx-b70db42088342716,.service-expired.jsx-b70db42088342716,.service-status.jsx-b70db42088342716,.service-actions.jsx-b70db42088342716,.service-used.jsx-b70db42088342716{width:100%;min-width:0}.service-actions.jsx-b70db42088342716{text-align:left;margin-top:8px}}"})]}):(0,a.jsx)("p",{children:"No valid data."})}},4338:()=>{}},e=>{var s=s=>e(e.s=s);e.O(0,[3197,6053,3418,8331,2453,5262,7239,2084,1106,8728,3067,6740,3093,7078,5029,6174,460,355,1609,636,6593,8792],()=>s(4997)),_N_E=e.O()}]);