(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2078],{4731:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-purchase-form/purchased-manager/update-purchase",function(){return a(1401)}])},5204:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var n=a(4848);a(6540);var r=a(8331);let s=e=>{let{title:t,children:a,maxWidth:s=1200,fullWidth:o=!1}=e;return(0,n.jsx)(r.A,{title:t,bordered:!1,style:{width:"100%",maxWidth:o?"100%":s,margin:"0 auto",transition:"max-width 0.2s ease-in-out"},children:a})}},1603:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var n=a(5872),r=a(1280);let s=n.A.generatePicker(r.A)},1280:(e,t,a)=>{"use strict";var n=a(4994).default;t.A=void 0;var r=n(a(5093)),s=a(3657);t.A={getNow:function(){return(0,r.default)()},getFixedDate:function(e){return(0,r.default)(e,"YYYY-MM-DD")},getEndDate:function(e){return e.clone().endOf("month")},getWeekDay:function(e){var t=e.clone().locale("en_US");return t.weekday()+t.localeData().firstDayOfWeek()},getYear:function(e){return e.year()},getMonth:function(e){return e.month()},getDate:function(e){return e.date()},getHour:function(e){return e.hour()},getMinute:function(e){return e.minute()},getSecond:function(e){return e.second()},getMillisecond:function(e){return e.millisecond()},addYear:function(e,t){return e.clone().add(t,"year")},addMonth:function(e,t){return e.clone().add(t,"month")},addDate:function(e,t){return e.clone().add(t,"day")},setYear:function(e,t){return e.clone().year(t)},setMonth:function(e,t){return e.clone().month(t)},setDate:function(e,t){return e.clone().date(t)},setHour:function(e,t){return e.clone().hour(t)},setMinute:function(e,t){return e.clone().minute(t)},setSecond:function(e,t){return e.clone().second(t)},setMillisecond:function(e,t){return e.clone().millisecond(t)},isAfter:function(e,t){return e.isAfter(t)},isValidate:function(e){return e.isValid()},locale:{getWeekFirstDay:function(e){return(0,r.default)().locale(e).localeData().firstDayOfWeek()},getWeekFirstDate:function(e,t){return t.clone().locale(e).weekday(0)},getWeek:function(e,t){return t.clone().locale(e).week()},getShortWeekDays:function(e){return(0,r.default)().locale(e).localeData().weekdaysMin()},getShortMonths:function(e){return(0,r.default)().locale(e).localeData().monthsShort()},format:function(e,t,a){return t.clone().locale(e).format(a)},parse:function(e,t,a){for(var n=[],o=0;o<a.length;o+=1){var c=a[o],i=t;if(c.includes("wo")||c.includes("Wo")){var l=(c=c.replace(/wo/g,"w").replace(/Wo/g,"W")).match(/[-YyMmDdHhSsWwGg]+/g),d=i.match(/[-\d]+/g);l&&d?(c=l.join(""),i=d.join("")):n.push(c.replace(/o/g,""))}var u=(0,r.default)(i,c,e,!0);if(u.isValid())return u}for(var h=0;h<n.length;h+=1){var f=(0,r.default)(t,n[h],e,!1);if(f.isValid())return(0,s.noteOnce)(!1,"Not match any format strictly and fallback to fuzzy match. Please help to fire a issue about this."),f}return null}}}},3657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.call=i,t.default=void 0,t.note=o,t.noteOnce=d,t.preMessage=void 0,t.resetWarned=c,t.warning=s,t.warningOnce=l;var a={},n=[],r=t.preMessage=function(e){n.push(e)};function s(e,t){}function o(e,t){}function c(){a={}}function i(e,t,n){t||a[n]||(e(!1,n),a[n]=!0)}function l(e,t){i(s,e,t)}function d(e,t){i(o,e,t)}l.preMessage=r,l.resetWarned=c,l.noteOnce=d,t.default=l},1401:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var n=a(4848),r=a(6540),s=a(6715),o=a(8728),c=a(1027),i=a(1744),l=a(6740),d=a(1531),u=a(3608),h=a(5093),f=a.n(h),p=a(1609),g=a(5204),m=a(3093),x=a(1603);let{Option:y}=o.A,j=e=>{let{value:t="",onChange:a}=e;return(0,n.jsx)(c.A,{value:t,onChange:e=>{let{value:t}=e.target;(/^\d+(\.\d{0,2})?$/.test(t)||""===t)&&a(t)},placeholder:"100.00"})},{Panel:v}=i.A,A=()=>{let e=(0,s.useRouter)(),{data:t}=e.query,[a,h]=(0,r.useState)(!0),[A,w]=(0,r.useState)(""),[D,S]=(0,r.useState)(""),[b]=l.A.useForm(),[k,I]=(0,r.useState)(!1),[M,U]=(0,r.useState)(!1),[C,_]=(0,r.useState)(""),[O,P]=(0,r.useState)("");(0,r.useEffect)(()=>{P(localStorage.getItem("csname")||"")},[]);let Y=()=>{{let t=localStorage.getItem("transactionId"),a=localStorage.getItem("totalPurchase"),n=localStorage.getItem("csid");t&&a&&n&&O?e.push("/manage-purchase-form/purchased-manager?data=".concat(btoa("transactionId=".concat(t,"&totalPurchase=").concat(a,"&csid=").concat(n,"&csname=").concat(O)))):window.history.back()}};(0,r.useEffect)(()=>{if(t){let e=JSON.parse(atob(t));console.log("svrdata",e),w(e.transactionId),console.log("tras",A),S(e.serviceid),_(e.serviceName),b.setFieldsValue({transactionId:e.transactionId,user:e.customerName,creditsUsed:e.creditUsed,purchaseDate:e.expirationService?f()(e.expirationService):null,paymentMethod:"Credit Card",status:e.status||"Pending",notes:""}),h(!1)}},[t,b]);let E=async()=>{let e=b.getFieldsValue();console.log("Updated Values:",e);let t={transactionId:A,serviceId:D||"",creditUsed:parseFloat(e.creditsUsed),status:e.status,action:"update credit used"};if(console.log("Updated Data:",t),"Draft"===e.status){localStorage.setItem("draftPurchaseData",JSON.stringify(t)),m.oR.success("Draft saved successfully!"),I(!1),U(!1);return}try{let e=await fetch("".concat("http://192.168.0.104:5216/api","/purchaseservice/update-purchase"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t=await e.json();throw console.error("Error response:",t),Error("Network response was not ok")}m.oR.success("Purchase updated successfully! This change can be seen in history."),I(!1),U(!1)}catch(e){m.oR.error("Failed to update purchase."),console.error("Error updating purchase:",e)}},N=async(e,t)=>{let a={transactionId:A,ServiceId:D,CreditUsed:b.getFieldValue("creditsUsed"),Status:b.getFieldValue("status"),action:"update credit used"};try{let e=await fetch("".concat("http://192.168.0.104:5216/api","/purchaseservice/update-expired-date"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});console.log(a),e.ok?m.oR.success("Expired date updated successfully!"):m.oR.error("Failed to update expired date.")}catch(e){console.error("Error updating expired date:",e)}};return(0,n.jsxs)(p.A,{children:[(0,n.jsx)(g.A,{title:"Revise Purchase Transaction ".concat(A),children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{children:["Service ",C||"Unknown Service"," - ",O||"Unknown User"]}),(0,n.jsx)("br",{}),(0,n.jsxs)(l.A,{form:b,layout:"vertical",children:[(0,n.jsx)(l.A.Item,{label:"Transaction ID",name:"transactionId",children:(0,n.jsx)(c.A,{disabled:!0})}),(0,n.jsx)(l.A.Item,{label:"Customer ",name:"user",children:(0,n.jsx)(c.A,{disabled:!0})}),(0,n.jsxs)(i.A,{defaultActiveKey:["1","2"],children:[(0,n.jsx)(v,{header:"Expired Date",children:(0,n.jsx)(l.A.Item,{label:"Expired Date",name:"purchaseDate",children:(0,n.jsx)(x.A,{showTime:!0,format:"YYYY-MM-DD HH:mm",style:{width:"100%"},onChange:N})})},"1"),(0,n.jsx)(v,{header:"Credits Used",children:(0,n.jsxs)(l.A.Item,{label:"Credits Used",children:[(0,n.jsx)("label",{children:b.getFieldValue("creditsUsed")}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)(d.Ay,{type:"primary",onClick:()=>{I(!0)},children:"Update"})]})},"2")]}),(0,n.jsxs)(u.A,{title:"Update Credits Used",visible:k,onOk:()=>{U(!0)},onCancel:()=>{I(!1)},children:[(0,n.jsx)(l.A.Item,{label:"Date",name:"purchaseDate",children:(0,n.jsx)(x.A,{disabled:!0,showTime:!0,format:"YYYY-MM-DD HH:mm",style:{width:"100%"}})}),(0,n.jsx)(l.A.Item,{label:"Value",name:"creditsUsed",rules:[{required:!0,message:"Please input value!"}],children:(0,n.jsx)(j,{value:b.getFieldValue("creditsUsed"),onChange:e=>b.setFieldsValue({creditsUsed:e})})}),(0,n.jsx)(l.A.Item,{label:"Status",name:"status",children:(0,n.jsxs)(o.A,{placeholder:"Select status",children:[(0,n.jsx)(y,{value:"Completed",children:"Confirm"}),(0,n.jsx)(y,{value:"Pending",children:"Pending"}),(0,n.jsx)(y,{value:"Draft",children:"Draft"})]})})]}),(0,n.jsxs)(u.A,{title:"Confirmation",centered:!0,visible:M,onOk:E,onCancel:()=>{U(!1)},children:[(0,n.jsx)("p",{children:"Are you sure you want to update?"}),(0,n.jsx)("p",{children:"This change will be reflected on the history page."})]}),(0,n.jsx)(l.A.Item,{children:(0,n.jsx)(d.Ay,{type:"default",onClick:()=>{Y()},style:{marginBottom:16},children:"Back"})})]})]})}),(0,n.jsx)(m.N9,{})]})}},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}},e=>{var t=t=>e(e.s=t);e.O(0,[3197,994,1531,8331,3418,2453,5262,7239,2084,1106,8728,3067,6740,3093,3608,6174,1744,1609,636,6593,8792],()=>t(4731)),_N_E=e.O()}]);